import{_ as w,P as B,Q as n,R as d,S as i,T as t,aB as f,V as e,aC as g,U as h,a0 as p,a2 as G,a1 as F,aD as k,aE as q,aF as A,X as b,W as u,L as y,at as C,a3 as V,Z as m}from"./index.2a7f6c5f.js";import{d as E,e as _}from"./format.fbac3fc7.js";import{Q as N}from"./QBtnDropdown.9ab3e512.js";import{Q as v}from"./QChip.27ecebf4.js";import{Q as O}from"./QMarkupTable.9fdfde98.js";import{Q as S,a as U}from"./QSelect.1129592e.js";import{Q as R}from"./QForm.d880e06d.js";import{Q as T}from"./QPage.8c30c3bd.js";import{h as Q}from"./moment.40bc58bf.js";import{C as Y}from"./Card2Component.0dc672fe.js";import"./index.aa4d44c1.js";import{I as D}from"./Imprimir.33b2d9b3.js";const L={name:"IndexPage",components:{Card2Component:Y},data(){return{loading:!1,fechaInicio:Q().format("YYYY-MM-DD"),fechaFin:Q().format("YYYY-MM-DD"),sales:[],ganancia1:{},ganancia2:{},ganancia3:{},ganancia4:{},egresoDialog:!1,egreso:{},provedores:[]}},mounted(){this.salesGet(),this.provedoresGet()},methods:{egresoPost(){this.loading=!0,this.$axios.post("/egresos",this.egreso).then(l=>{this.$alert.success("Egreso registrado"),D.recibo(l.data),this.salesGet(),this.egresoDialog=!1}).catch(l=>{console.error(l),this.$alert.error("Error al registrar el egreso")}).finally(()=>{this.loading=!1})},provedoresGet(){this.$axios.get("/provedores").then(l=>{this.provedores=l.data}).catch(l=>{console.error(l)})},egreseClick(){this.egresoDialog=!0,this.egreso={total:"",provedor_id:"",descripcion:""}},reimprimir(l){D.recibo(l)},anular(l){this.$alert.confirm("\xBFEst\xE1 seguro de anular la venta?").onOk(()=>{this.$axios.post("saleAnular",{id:l.id}).then(s=>{this.$alert.success("Venta anulada"),this.salesGet()}).catch(s=>{console.error(s),this.$alert.error("Error al anular la venta")})})},salesGet(){this.loading=!0,this.$axios.get("/sales",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(l=>{this.sales=l.data,this.gananciaGet()}).catch(l=>{console.error(l)}).finally(()=>{this.loading=!1})},gananciaGet(){this.loading=!0,this.$axios.post("/reportGanancia",{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}).then(l=>{console.log(l.data),this.ganancia1=l.data[0],this.ganancia2=l.data[1],this.ganancia3=l.data[2],this.ganancia4=l.data[3]}).catch(l=>{console.error(l)}).finally(()=>{this.loading=!1})}},computed:{ingresos(){let l=0;return this.sales.forEach(s=>{s.type==="INGRESO"&&s.status!=="ANULADO"&&(l+=s.total)}),l},egresos(){let l=0;return this.sales.forEach(s=>{s.type==="EGRESO"&&s.status!=="ANULADO"&&(l+=s.total)}),l},utilidad(){return this.ingresos-this.egresos}}},P={class:"row"},M={class:"col-12 col-md-2"},z={class:"col-12 col-md-2"},H={class:"col-12 col-md-2 text-center"},J={class:"col-12 col-md-6 text-right"},W={class:"col-12 col-md-4 q-pa-xs"},X={class:"col-12 col-md-4 q-pa-xs"},Z={class:"col-12 col-md-4 q-pa-xs"},j={class:"row"},K={class:"col-xs-12 col-md-3 q-pa-xs"},$={class:"col-xs-12 col-md-3 q-pa-xs"},ee={class:"col-xs-12 col-md-3 q-pa-xs"},oe={class:"col-xs-12 col-md-3 q-pa-xs"},te={class:"row"},le={class:"col-12"},se=e("thead",{class:"bg-black text-white"},[e("tr",null,[e("th",null,"Opciones"),e("th",null,"Fecha"),e("th",null,"Tipo"),e("th",null,"Descripcion"),e("th",null,"Name"),e("th",null,"Total"),e("th",null,"Usuario")])],-1),ae={key:0},ie={class:"text-caption",style:{"max-width":"400px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},ne={class:"text-bold"},re={key:1},ce=e("tr",null,[e("td",{colspan:"7",class:"text-center"},"No hay ventas")],-1),de=[ce],ue=e("div",{class:"text-h6"},"Egreso",-1),he=e("div",{id:"myelement",class:"hidden"},null,-1);function ge(l,s,pe,me,a,r){const c=B("card2-component");return n(),d(T,{class:"q-pa-md bg-grey-3"},{default:i(()=>[t(k,null,{default:i(()=>[t(f,{class:"q-pa-xs"},{default:i(()=>[e("div",P,[e("div",M,[t(g,{modelValue:a.fechaInicio,"onUpdate:modelValue":s[0]||(s[0]=o=>a.fechaInicio=o),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",z,[t(g,{modelValue:a.fechaFin,"onUpdate:modelValue":s[1]||(s[1]=o=>a.fechaFin=o),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",H,[t(h,{label:"Buscar",color:"indigo",onClick:r.salesGet,loading:a.loading,"no-caps":"",icon:"search",class:"text-bold"},null,8,["onClick","loading"])]),e("div",J,[t(h,{label:"Egreso",color:"red",onClick:r.egreseClick,loading:a.loading,"no-caps":"",icon:"add_circle_outline",class:"text-bold"},null,8,["onClick","loading"])]),e("div",W,[t(c,{title:"Ingresos",subtitle:r.ingresos+" Bs.",icon:"trending_up",color:"green"},null,8,["subtitle"])]),e("div",X,[t(c,{title:"Egresos",subtitle:r.egresos+" Bs.",icon:"trending_down",color:"red"},null,8,["subtitle"])]),e("div",Z,[t(c,{title:"Utilidad",subtitle:r.utilidad+" Bs.",icon:"trending_flat",color:"blue"},null,8,["subtitle"])])]),e("div",j,[e("div",K,[t(c,{title:"EFECTIVO",subtitle:a.ganancia1.total+" Bs.",icon:"point_of_sale",color:"amber",dense:""},null,8,["subtitle"])]),e("div",$,[t(c,{title:"TARJETA",subtitle:a.ganancia2.total+" Bs.",icon:"credit_card",color:"indigo"},null,8,["subtitle"])]),e("div",ee,[t(c,{title:"ONLINE",subtitle:a.ganancia3.total+" Bs.",icon:"shopping_cart",color:"cyan"},null,8,["subtitle"])]),e("div",oe,[t(c,{title:"QR",subtitle:a.ganancia4.total+" Bs.",icon:"qr_code_scanner",color:"deep-orange"},null,8,["subtitle"])])]),e("div",te,[e("div",le,[t(O,{dense:"","wrap-cells":""},{default:i(()=>[se,a.sales.length>0?(n(),p("tbody",ae,[(n(!0),p(G,null,F(a.sales,o=>{var x;return n(),p("tr",{key:o.id},[e("td",null,[b(u(o.numero)+" ",1),o.status!=="ANULADO"?(n(),d(N,{key:0,label:"Opciones","no-caps":"",size:"10px",dense:"",color:o.type==="EGRESO"?"red":"green","auto-close":""},{default:i(()=>[y((n(),d(E,{clickable:"",onClick:I=>r.reimprimir(o)},{default:i(()=>[t(_,{avatar:""},{default:i(()=>[t(C,{name:"print"})]),_:1}),t(_,null,{default:i(()=>[b("Reimprimir")]),_:1})]),_:2},1032,["onClick"])),[[V]]),y((n(),d(E,{clickable:"",onClick:I=>r.anular(o)},{default:i(()=>[t(_,{avatar:""},{default:i(()=>[t(C,{name:"cancel"})]),_:1}),t(_,null,{default:i(()=>[b("Anular")]),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1032,["color"])):m("",!0),o.status==="ANULADO"?(n(),d(v,{key:1,color:"red","text-color":"white",label:"Anulado",size:"12px",dense:""})):m("",!0)]),e("td",null,u(l.$filters.formatdMYHi(o.date+" "+o.time)),1),e("td",null,[o.type==="INGRESO"?(n(),d(v,{key:0,color:"green","text-color":"white",label:"Ingreso",size:"12px",dense:""})):m("",!0),o.type==="EGRESO"?(n(),d(v,{key:1,color:"red","text-color":"white",label:"Egreso",size:"12px",dense:""})):m("",!0)]),e("td",null,[e("div",ie,u(o.descripcion),1)]),e("td",null,u(o.name),1),e("td",ne,u(o.total)+" Bs",1),e("td",null,u((x=o.user)==null?void 0:x.name),1)])}),128))])):(n(),p("tbody",re,de))]),_:1})])])]),_:1})]),_:1}),t(A,{modelValue:a.egresoDialog,"onUpdate:modelValue":s[7]||(s[7]=o=>a.egresoDialog=o),persistent:""},{default:i(()=>[t(k,null,{default:i(()=>[t(f,{class:"row items-center q-pb-none"},{default:i(()=>[ue,t(S),t(h,{flat:"",round:"",dense:"",icon:"close",onClick:s[2]||(s[2]=o=>a.egresoDialog=!1)})]),_:1}),t(f,null,{default:i(()=>[t(R,{onSubmit:r.egresoPost},{default:i(()=>[t(g,{modelValue:a.egreso.total,"onUpdate:modelValue":s[3]||(s[3]=o=>a.egreso.total=o),label:"Total",type:"number",outlined:"",dense:"",rules:[o=>!!o||"Campo requerido"],step:"0.01"},null,8,["modelValue","rules"]),t(U,{modelValue:a.egreso.provedor_id,"onUpdate:modelValue":s[4]||(s[4]=o=>a.egreso.provedor_id=o),label:"Provedor",outlined:"",dense:"",options:a.provedores,"option-value":"id","option-label":"name",rules:[o=>!!o||"Campo requerido"]},null,8,["modelValue","options","rules"]),t(g,{modelValue:a.egreso.descripcion,"onUpdate:modelValue":s[5]||(s[5]=o=>a.egreso.descripcion=o),label:"Descripcion",type:"text",outlined:"",dense:"",rules:[o=>!!o||"Campo requerido"]},null,8,["modelValue","rules"]),t(q,{align:"right"},{default:i(()=>[t(h,{label:"Cancelar",color:"red",onClick:s[6]||(s[6]=o=>a.egresoDialog=!1),"no-caps":"",icon:"close",loading:a.loading},null,8,["loading"]),t(h,{label:"Guardar",color:"green",type:"submit","no-caps":"",icon:"save",loading:a.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),he]),_:1})}var Ie=w(L,[["render",ge]]);export{Ie as default};
