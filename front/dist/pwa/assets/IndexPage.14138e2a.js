import{_ as w,P as G,Q as i,R as d,S as a,T as l,aB as _,V as o,aC as m,U as u,a0 as p,a2 as S,a1 as U,aD as k,aE as A,aF as B,X as b,W as c,L as C,at as y,a3 as V,Z as g}from"./index.033fb2bb.js";import{d as Q,e as h}from"./format.26cbf75d.js";import{Q as F}from"./QBtnDropdown.78e6f2a5.js";import{Q as v}from"./QChip.2fbc3c7c.js";import{Q as N}from"./QMarkupTable.1afdc17d.js";import{Q as O,a as q}from"./QSelect.1408f65a.js";import{Q as Y}from"./QForm.42a0d06d.js";import{Q as R}from"./QPage.9c7dd5af.js";import{h as D}from"./moment.40bc58bf.js";import{C as P}from"./Card2Component.43a82f4d.js";import"./index.aa4d44c1.js";import{I as E}from"./Imprimir.1c35c51b.js";const L={name:"IndexPage",components:{Card2Component:P},data(){return{loading:!1,fechaInicio:D().format("YYYY-MM-DD"),fechaFin:D().format("YYYY-MM-DD"),sales:[],egresoDialog:!1,egreso:{},provedores:[]}},mounted(){this.salesGet(),this.provedoresGet()},methods:{egresoPost(){this.loading=!0,this.$axios.post("/egresos",this.egreso).then(s=>{this.$alert.success("Egreso registrado"),E.recibo(s.data),this.salesGet(),this.egresoDialog=!1}).catch(s=>{console.error(s),this.$alert.error("Error al registrar el egreso")}).finally(()=>{this.loading=!1})},provedoresGet(){this.$axios.get("/provedores").then(s=>{this.provedores=s.data}).catch(s=>{console.error(s)})},egreseClick(){this.egresoDialog=!0,this.egreso={total:"",provedor_id:"",descripcion:""}},reimprimir(s){E.recibo(s)},anular(s){this.$alert.confirm("\xBFEst\xE1 seguro de anular la venta?").onOk(()=>{this.$axios.post("saleAnular",{id:s.id}).then(t=>{this.$alert.success("Venta anulada"),this.salesGet()}).catch(t=>{console.error(t),this.$alert.error("Error al anular la venta")})})},salesGet(){this.loading=!0,this.$axios.get("/sales",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(s=>{this.sales=s.data}).catch(s=>{console.error(s)}).finally(()=>{this.loading=!1})}},computed:{ingresos(){let s=0;return this.sales.forEach(t=>{t.type==="INGRESO"&&t.status!=="ANULADO"&&(s+=t.total)}),s},egresos(){let s=0;return this.sales.forEach(t=>{t.type==="EGRESO"&&t.status!=="ANULADO"&&(s+=t.total)}),s},utilidad(){return this.ingresos-this.egresos}}},M={class:"row"},T={class:"col-12 col-md-2"},z={class:"col-12 col-md-2"},H={class:"col-12 col-md-2 text-center"},W={class:"col-12 col-md-6 text-right"},X={class:"col-12 col-md-4 q-pa-xs"},Z={class:"col-12 col-md-4 q-pa-xs"},j={class:"col-12 col-md-4 q-pa-xs"},J={class:"col-12"},K=o("thead",{class:"bg-black text-white"},[o("tr",null,[o("th",null,"Opciones"),o("th",null,"Fecha"),o("th",null,"Tipo"),o("th",null,"Descripcion"),o("th",null,"Name"),o("th",null,"Total"),o("th",null,"Usuario")])],-1),$={key:0},ee={class:"text-caption",style:{"max-width":"400px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},oe={class:"text-bold"},le={key:1},te=o("tr",null,[o("td",{colspan:"7",class:"text-center"},"No hay ventas")],-1),se=[te],re=o("div",{class:"text-h6"},"Egreso",-1),ae=o("div",{id:"myelement",class:"hidden"},null,-1);function ie(s,t,ne,de,r,n){const f=G("card2-component");return i(),d(R,{class:"q-pa-md bg-grey-3"},{default:a(()=>[l(k,null,{default:a(()=>[l(_,{class:"q-pa-xs"},{default:a(()=>[o("div",M,[o("div",T,[l(m,{modelValue:r.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=e=>r.fechaInicio=e),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),o("div",z,[l(m,{modelValue:r.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=e=>r.fechaFin=e),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),o("div",H,[l(u,{label:"Buscar",color:"indigo",onClick:n.salesGet,loading:r.loading,"no-caps":"",icon:"search",class:"text-bold"},null,8,["onClick","loading"])]),o("div",W,[l(u,{label:"Egreso",color:"red",onClick:n.egreseClick,loading:r.loading,"no-caps":"",icon:"add_circle_outline",class:"text-bold"},null,8,["onClick","loading"])]),o("div",X,[l(f,{title:"Ingresos",subtitle:n.ingresos+" Bs.",icon:"trending_up",color:"green"},null,8,["subtitle"])]),o("div",Z,[l(f,{title:"Egresos",subtitle:n.egresos+" Bs.",icon:"trending_down",color:"red"},null,8,["subtitle"])]),o("div",j,[l(f,{title:"Utilidad",subtitle:n.utilidad+" Bs.",icon:"trending_flat",color:"blue"},null,8,["subtitle"])]),o("div",J,[l(N,{dense:"","wrap-cells":""},{default:a(()=>[K,r.sales.length>0?(i(),p("tbody",$,[(i(!0),p(S,null,U(r.sales,e=>{var x;return i(),p("tr",{key:e.id},[o("td",null,[b(c(e.numero)+" ",1),e.status!=="ANULADO"?(i(),d(F,{key:0,label:"Opciones","no-caps":"",size:"10px",dense:"",color:e.type==="EGRESO"?"red":"green","auto-close":""},{default:a(()=>[C((i(),d(Q,{clickable:"",onClick:I=>n.reimprimir(e)},{default:a(()=>[l(h,{avatar:""},{default:a(()=>[l(y,{name:"print"})]),_:1}),l(h,null,{default:a(()=>[b("Reimprimir")]),_:1})]),_:2},1032,["onClick"])),[[V]]),C((i(),d(Q,{clickable:"",onClick:I=>n.anular(e)},{default:a(()=>[l(h,{avatar:""},{default:a(()=>[l(y,{name:"cancel"})]),_:1}),l(h,null,{default:a(()=>[b("Anular")]),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1032,["color"])):g("",!0),e.status==="ANULADO"?(i(),d(v,{key:1,color:"red","text-color":"white",label:"Anulado",size:"12px",dense:""})):g("",!0)]),o("td",null,c(s.$filters.formatdMYHi(e.date+" "+e.time)),1),o("td",null,[e.type==="INGRESO"?(i(),d(v,{key:0,color:"green","text-color":"white",label:"Ingreso",size:"12px",dense:""})):g("",!0),e.type==="EGRESO"?(i(),d(v,{key:1,color:"red","text-color":"white",label:"Egreso",size:"12px",dense:""})):g("",!0)]),o("td",null,[o("div",ee,c(e.descripcion),1)]),o("td",null,c(e.name),1),o("td",oe,c(e.total)+" Bs",1),o("td",null,c((x=e.user)==null?void 0:x.name),1)])}),128))])):(i(),p("tbody",le,se))]),_:1})])])]),_:1})]),_:1}),l(B,{modelValue:r.egresoDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>r.egresoDialog=e),persistent:""},{default:a(()=>[l(k,null,{default:a(()=>[l(_,{class:"row items-center q-pb-none"},{default:a(()=>[re,l(O),l(u,{flat:"",round:"",dense:"",icon:"close",onClick:t[2]||(t[2]=e=>r.egresoDialog=!1)})]),_:1}),l(_,null,{default:a(()=>[l(Y,{onSubmit:n.egresoPost},{default:a(()=>[l(m,{modelValue:r.egreso.total,"onUpdate:modelValue":t[3]||(t[3]=e=>r.egreso.total=e),label:"Total",type:"number",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"],step:"0.01"},null,8,["modelValue","rules"]),l(q,{modelValue:r.egreso.provedor_id,"onUpdate:modelValue":t[4]||(t[4]=e=>r.egreso.provedor_id=e),label:"Provedor",outlined:"",dense:"",options:r.provedores,"option-value":"id","option-label":"name",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","options","rules"]),l(m,{modelValue:r.egreso.descripcion,"onUpdate:modelValue":t[5]||(t[5]=e=>r.egreso.descripcion=e),label:"Descripcion",type:"text",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),l(A,{align:"right"},{default:a(()=>[l(u,{label:"Cancelar",color:"red",onClick:t[6]||(t[6]=e=>r.egresoDialog=!1),"no-caps":"",icon:"close",loading:r.loading},null,8,["loading"]),l(u,{label:"Guardar",color:"green",type:"submit","no-caps":"",icon:"save",loading:r.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),ae]),_:1})}var Ce=w(L,[["render",ie]]);export{Ce as default};
