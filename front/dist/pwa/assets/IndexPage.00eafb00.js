import{_ as B,P as S,Q as r,R as h,S as i,T as o,aB as p,V as a,aC as g,U as d,a0 as f,a2 as U,a1 as A,aD as b,aE as y,aF as V,X as x,W as m,L as j,at as E,a3 as D,Z as _}from"./index.a8e6d158.js";import{d as I,e as C}from"./format.3b18f73c.js";import{Q as N}from"./QBtnDropdown.06bf1729.js";import{Q as v}from"./QChip.2f8e696d.js";import{Q as O}from"./QMarkupTable.467d70a2.js";import{Q,a as R}from"./QSelect.c3f256f5.js";import{Q as G}from"./QForm.82c29615.js";import{Q as P}from"./QPage.269169af.js";import{h as w}from"./moment.40bc58bf.js";import{C as T}from"./Card2Component.67f89226.js";import"./index.aa4d44c1.js";import{I as q}from"./Imprimir.e3cd106e.js";const Y={name:"IndexPage",components:{Card2Component:T},data(){return{loading:!1,caja:[],dialogCaja:!1,fechaInicio:w().format("YYYY-MM-DD"),fechaFin:w().format("YYYY-MM-DD"),sales:[],ganancia1:{},ganancia2:{},ganancia3:{},ganancia4:{},egresoDialog:!1,egreso:{},provedores:[],chica:{},cajaChica:{monto:0}}},mounted(){this.salesGet(),this.provedoresGet(),this.ultimaCajaGet()},methods:{ultimaCajaGet(){this.$axios.get("/ultimaCaja").then(e=>{this.cajaChica=e.data}).catch(e=>{console.error(e),this.$alert.error("Error Caja")})},cajaPost(){this.loading=!0,this.$axios.post("/caja",this.chica).then(e=>{this.$alert.success("Caja  registrado"),this.ultimaCajaGet(),this.dialogCaja=!1}).catch(e=>{console.error(e),this.$alert.error("Error al registrar")}).finally(()=>{this.loading=!1})},cajaClick(){this.dialogCaja=!0,this.chica={}},getCaja(){this.loading=!0,this.$axios.post("/totalCaja",{ini:this.fechaInicio,fin:this.fechaFin}).then(e=>{this.caja=e.data}).catch(e=>{console.error(e),this.$alert.error("Error Caja")}).finally(()=>{this.loading=!1})},egresoPost(){this.loading=!0,this.$axios.post("/egresos",this.egreso).then(e=>{this.$alert.success("Egreso registrado"),q.recibo(e.data),this.ultimaCajaGet(),this.egresoDialog=!1}).catch(e=>{console.error(e),this.$alert.error("Error al registrar el egreso")}).finally(()=>{this.loading=!1})},provedoresGet(){this.$axios.get("/provedores").then(e=>{this.provedores=e.data}).catch(e=>{console.error(e)})},egreseClick(){this.egresoDialog=!0,this.egreso={total:"",provedor_id:"",descripcion:""}},reimprimir(e){q.recibo(e)},anular(e){this.$alert.confirm("\xBFEst\xE1 seguro de anular la venta?").onOk(()=>{this.$axios.post("saleAnular",{id:e.id}).then(l=>{this.$alert.success("Venta anulada"),this.salesGet()}).catch(l=>{console.error(l),this.$alert.error("Error al anular la venta")})})},salesGet(){this.loading=!0,this.$axios.get("/sales",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(e=>{this.sales=e.data,this.gananciaGet()}).catch(e=>{console.error(e)}).finally(()=>{this.loading=!1})},gananciaGet(){this.loading=!0,this.$axios.post("/reportGanancia",{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}).then(e=>{console.log(e.data),this.ganancia1=e.data[0],this.ganancia2=e.data[1],this.ganancia3=e.data[2],this.ganancia4=e.data[3]}).catch(e=>{console.error(e)}).finally(()=>{this.loading=!1})}},computed:{ingresos(){let e=0;return this.sales.forEach(l=>{l.type==="INGRESO"&&l.status!=="ANULADO"&&(e+=l.total)}),e},egresos(){let e=0;return this.sales.forEach(l=>{l.type==="EGRESO"&&l.status!=="ANULADO"&&(e+=l.total)}),e},totalCaja(){let e=0;return this.caja.forEach(l=>{e=e+parseFloat(l.monto)}),e},totalGasto(){return this.totalCaja-this.egresos}}},L={class:"row"},M={class:"col-12 col-md-2"},z={class:"col-12 col-md-2"},H={class:"col-12 col-md-2 text-center"},J={class:"col-12 col-md-6 text-right"},W={class:"col-12 col-md-4 q-pa-xs"},X={class:"col-12 col-md-4 q-pa-xs"},Z={class:"col-12 col-md-4 q-pa-xs"},K={class:"row"},$={class:"col-xs-12 col-md-3 q-pa-xs"},ee={class:"col-xs-12 col-md-3 q-pa-xs"},oe={class:"col-xs-12 col-md-3 q-pa-xs"},le={class:"col-xs-12 col-md-3 q-pa-xs"},te={class:"row"},ae={class:"col-12"},se=a("thead",{class:"bg-black text-white"},[a("tr",null,[a("th",null,"Opciones"),a("th",null,"Fecha"),a("th",null,"Tipo"),a("th",null,"Descripcion"),a("th",null,"Name"),a("th",null,"Total"),a("th",null,"Usuario")])],-1),ie={key:0},ne={class:"text-caption",style:{"max-width":"400px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},re={class:"text-bold"},ce={key:1},de=a("tr",null,[a("td",{colspan:"7",class:"text-center"},"No hay ventas")],-1),ue=[de],he=a("div",{class:"text-h6"},"Egreso",-1),ge=a("div",{class:"text-h6"},"Ingreso Caja Chica Dia",-1),me=a("div",{id:"myelement",class:"hidden"},null,-1);function pe(e,l,fe,_e,t,c){const u=S("card2-component");return r(),h(P,{class:"q-pa-md bg-grey-3"},{default:i(()=>[o(b,null,{default:i(()=>[o(p,{class:"q-pa-xs"},{default:i(()=>{var s;return[a("div",L,[a("div",M,[o(g,{modelValue:t.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=n=>t.fechaInicio=n),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",z,[o(g,{modelValue:t.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=n=>t.fechaFin=n),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",H,[o(d,{label:"Buscar",color:"indigo",onClick:c.salesGet,loading:t.loading,"no-caps":"",icon:"search",class:"text-bold"},null,8,["onClick","loading"])]),a("div",J,[o(d,{label:"Caja Chica",color:"indigo",onClick:c.cajaClick,loading:t.loading,"no-caps":"",icon:"attach_money",class:"text-bold"},null,8,["onClick","loading"]),o(d,{label:"Egreso",color:"red",onClick:c.egreseClick,loading:t.loading,"no-caps":"",icon:"add_circle_outline",class:"text-bold"},null,8,["onClick","loading"])]),a("div",W,[o(u,{title:"Ingresos",subtitle:c.ingresos+" Bs.",icon:"trending_up",color:"green"},null,8,["subtitle"])]),a("div",X,[o(u,{title:"Egresos",subtitle:c.egresos+" Bs.",icon:"trending_down",color:"red"},null,8,["subtitle"])]),a("div",Z,[o(u,{title:"Caja Chica",subtitle:((s=t.cajaChica)==null?void 0:s.monto)+" Bs.",icon:"fa-solid fa-cash-register",color:"blue"},null,8,["subtitle"])])]),a("div",K,[a("div",$,[o(u,{title:"EFECTIVO",subtitle:t.ganancia1.total+" Bs.",icon:"point_of_sale",color:"amber",dense:""},null,8,["subtitle"])]),a("div",ee,[o(u,{title:"TARJETA",subtitle:t.ganancia2.total+" Bs.",icon:"credit_card",color:"indigo"},null,8,["subtitle"])]),a("div",oe,[o(u,{title:"ONLINE",subtitle:t.ganancia3.total+" Bs.",icon:"shopping_cart",color:"cyan"},null,8,["subtitle"])]),a("div",le,[o(u,{title:"QR",subtitle:t.ganancia4.total+" Bs.",icon:"qr_code_scanner",color:"deep-orange"},null,8,["subtitle"])])]),a("div",te,[a("div",ae,[o(O,{dense:"","wrap-cells":""},{default:i(()=>[se,t.sales.length>0?(r(),f("tbody",ie,[(r(!0),f(U,null,A(t.sales,n=>{var k;return r(),f("tr",{key:n.id},[a("td",null,[x(m(n.numero)+" ",1),n.status!=="ANULADO"?(r(),h(N,{key:0,label:"Opciones","no-caps":"",size:"10px",dense:"",color:n.type==="EGRESO"?"red":"green","auto-close":""},{default:i(()=>[j((r(),h(I,{clickable:"",onClick:F=>c.reimprimir(n)},{default:i(()=>[o(C,{avatar:""},{default:i(()=>[o(E,{name:"print"})]),_:1}),o(C,null,{default:i(()=>[x("Reimprimir")]),_:1})]),_:2},1032,["onClick"])),[[D]]),j((r(),h(I,{clickable:"",onClick:F=>c.anular(n)},{default:i(()=>[o(C,{avatar:""},{default:i(()=>[o(E,{name:"cancel"})]),_:1}),o(C,null,{default:i(()=>[x("Anular")]),_:1})]),_:2},1032,["onClick"])),[[D]])]),_:2},1032,["color"])):_("",!0),n.status==="ANULADO"?(r(),h(v,{key:1,color:"red","text-color":"white",label:"Anulado",size:"12px",dense:""})):_("",!0)]),a("td",null,m(e.$filters.formatdMYHi(n.date+" "+n.time)),1),a("td",null,[n.type==="INGRESO"?(r(),h(v,{key:0,color:"green","text-color":"white",label:"Ingreso",size:"12px",dense:""})):_("",!0),n.type==="EGRESO"?(r(),h(v,{key:1,color:"red","text-color":"white",label:"Egreso",size:"12px",dense:""})):_("",!0)]),a("td",null,[a("div",ne,m(n.descripcion),1)]),a("td",null,m(n.name),1),a("td",re,m(n.total)+" Bs",1),a("td",null,m((k=n.user)==null?void 0:k.name),1)])}),128))])):(r(),f("tbody",ce,ue))]),_:1})])])]}),_:1})]),_:1}),o(V,{modelValue:t.egresoDialog,"onUpdate:modelValue":l[7]||(l[7]=s=>t.egresoDialog=s),persistent:""},{default:i(()=>[o(b,null,{default:i(()=>[o(p,{class:"row items-center q-pb-none"},{default:i(()=>[he,o(Q),o(d,{flat:"",round:"",dense:"",icon:"close",onClick:l[2]||(l[2]=s=>t.egresoDialog=!1)})]),_:1}),o(p,null,{default:i(()=>[o(G,{onSubmit:c.egresoPost},{default:i(()=>[o(g,{modelValue:t.egreso.total,"onUpdate:modelValue":l[3]||(l[3]=s=>t.egreso.total=s),label:"Total",type:"number",outlined:"",dense:"",rules:[s=>!!s||"Campo requerido"],step:"0.01"},null,8,["modelValue","rules"]),o(R,{modelValue:t.egreso.provedor_id,"onUpdate:modelValue":l[4]||(l[4]=s=>t.egreso.provedor_id=s),label:"Provedor",outlined:"",dense:"",options:t.provedores,"option-value":"id","option-label":"name",rules:[s=>!!s||"Campo requerido"]},null,8,["modelValue","options","rules"]),o(g,{modelValue:t.egreso.descripcion,"onUpdate:modelValue":l[5]||(l[5]=s=>t.egreso.descripcion=s),label:"Descripcion",type:"text",outlined:"",dense:"",rules:[s=>!!s||"Campo requerido"]},null,8,["modelValue","rules"]),o(y,{align:"right"},{default:i(()=>[o(d,{label:"Cancelar",color:"red",onClick:l[6]||(l[6]=s=>t.egresoDialog=!1),"no-caps":"",icon:"close",loading:t.loading},null,8,["loading"]),o(d,{label:"Guardar",color:"green",type:"submit","no-caps":"",icon:"save",loading:t.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(V,{modelValue:t.dialogCaja,"onUpdate:modelValue":l[12]||(l[12]=s=>t.dialogCaja=s),persistent:""},{default:i(()=>[o(b,null,{default:i(()=>[o(p,{class:"row items-center q-pb-none"},{default:i(()=>[ge,o(Q),o(d,{flat:"",round:"",dense:"",icon:"close",onClick:l[8]||(l[8]=s=>t.dialogCaja=!1)})]),_:1}),o(p,null,{default:i(()=>[o(G,{onSubmit:c.cajaPost},{default:i(()=>[o(g,{modelValue:t.chica.monto,"onUpdate:modelValue":l[9]||(l[9]=s=>t.chica.monto=s),label:"Monto",type:"number",outlined:"",dense:"",rules:[s=>!!s||"Campo requerido"],step:"0.01"},null,8,["modelValue","rules"]),o(g,{modelValue:t.chica.descripcion,"onUpdate:modelValue":l[10]||(l[10]=s=>t.chica.descripcion=s),label:"Descripcion",type:"text",outlined:"",dense:"",rules:[s=>!!s||"Campo requerido"]},null,8,["modelValue","rules"]),o(y,{align:"right"},{default:i(()=>[o(d,{label:"Cancelar",color:"red",onClick:l[11]||(l[11]=s=>t.dialogCaja=!1),"no-caps":"",icon:"close",loading:t.loading},null,8,["loading"]),o(d,{label:"Guardar",color:"green",type:"submit","no-caps":"",icon:"save",loading:t.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),me]),_:1})}var Ge=B(Y,[["render",pe]]);export{Ge as default};
