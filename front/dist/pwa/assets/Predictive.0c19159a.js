import{_ as y,P as v,Q as b,R as V,S as n,T as a,aB as l,V as i,aC as d,U as p,$ as m,aD as f,bb as x,bc as w}from"./index.453c62e5.js";import{Q as S}from"./QSelect.6082f557.js";import{Q as k}from"./QPage.62823b2d.js";import{m as D}from"./vue3-apexcharts.2ac52a68.js";import{h as C}from"./moment.40bc58bf.js";import"./format.6549254d.js";const _="http://127.0.0.1:5000",g="",T={name:"PredictivePage",components:{apexchart:D},data(){return{fecha_inicio:"2024-09-30",fecha_fin:C().format("YYYY-MM-DD"),products:[],selectedProduct:null,loadingGeneral:!1,loadingProduct:!1,chartOptions:{chart:{id:"predictive-chart",toolbar:{show:!0}},xaxis:{type:"datetime",title:{text:"Fecha"}},yaxis:{title:{text:"Total Ventas"}},stroke:{width:3},markers:{size:0},legend:{position:"top"},title:{text:"Predicci\xF3n de Ventas",align:"center"},tooltip:{x:{format:"yyyy-MM-dd"}}},chartSeries:[{name:"Ventas Totales",data:[]},{name:"Predicci\xF3n",data:[]}],chartOptionsProduct:{chart:{id:"predictive-product",toolbar:{show:!0}},xaxis:{type:"datetime",title:{text:"Fecha"}},yaxis:{title:{text:"Total Ventas (Producto)"}},stroke:{width:3},markers:{size:0},legend:{position:"top"},title:{text:"Predicci\xF3n de Ventas por Producto",align:"center"},tooltip:{x:{format:"yyyy-MM-dd"}}},chartSeriesProduct:[{name:"Ventas Totales (Producto)",data:[]},{name:"Predicci\xF3n (Producto)",data:[]}]}},mounted(){this.getProducts(),this.fetchChartData()},methods:{async getProducts(){try{const t=g?`${g}/products`:"products",{data:o}=await this.$axios.get(t);this.products=(o||[]).map(s=>({label:s.name||s.nombre||`#${s.id}`,value:s.id})),!this.selectedProduct&&this.products.length&&(this.selectedProduct=this.products[0].value)}catch(t){this.$q.notify({type:"negative",message:"Error obteniendo productos"}),console.error(t)}},_validateDates(){return!this.fecha_inicio||!this.fecha_fin?(this.$q.notify({type:"warning",message:"Selecciona rango de fechas"}),!1):this.fecha_inicio>this.fecha_fin?(this.$q.notify({type:"warning",message:"La fecha inicio no puede ser mayor que la fecha fin"}),!1):!0},async fetchChartData(){if(!!this._validateDates()){this.loadingGeneral=!0,this.chartSeries=[{name:"Ventas Totales",data:[]},{name:"Predicci\xF3n",data:[]}];try{const{data:t}=await this.$axios.post(`${_}/regresion`,{fecha_inicio:this.fecha_inicio,fecha_fin:this.fecha_fin}),o=(t==null?void 0:t.predicciones)||[],s=o.map(e=>[new Date(e.week).getTime(),Number(e.total_ventas||0)]),r=o.map(e=>[new Date(e.week).getTime(),Number(e.predicted||0)]);this.chartSeries=[{name:"Ventas Totales",data:s},{name:"Predicci\xF3n",data:r}]}catch(t){this.$q.notify({type:"negative",message:"Error obteniendo datos globales"}),console.error(t)}finally{this.loadingGeneral=!1}}},async fetchChartDataProduct(){if(!!this._validateDates()){if(!this.selectedProduct){this.$q.notify({type:"warning",message:"Selecciona un producto"});return}this.loadingProduct=!0,this.chartSeriesProduct=[{name:"Ventas Totales (Producto)",data:[]},{name:"Predicci\xF3n (Producto)",data:[]}];try{const{data:t}=await this.$axios.post(`${_}/regresion_producto`,{fecha_inicio:this.fecha_inicio,fecha_fin:this.fecha_fin,product_id:this.selectedProduct}),o=(t==null?void 0:t.predicciones)||[],s=o.map(e=>[new Date(e.week).getTime(),Number(e.total_ventas||0)]),r=o.map(e=>[new Date(e.week).getTime(),Number(e.predicted||0)]);this.chartSeriesProduct=[{name:"Ventas Totales (Producto)",data:s},{name:"Predicci\xF3n (Producto)",data:r}]}catch(t){this.$q.notify({type:"negative",message:"Error obteniendo datos del producto"}),console.error(t)}finally{this.loadingProduct=!1}}}}},P=t=>(x("data-v-b216f932"),t=t(),w(),t),q=P(()=>i("div",{class:"col-12 text-h6 text-weight-bold"},"Gr\xE1fico Predictivo de Ventas (Global)",-1)),Q={class:"col-12 col-md-3"},B={class:"col-12 col-md-3"},F={class:"col-12 col-md-auto"},G={class:"row justify-center"},M={class:"col-12 col-md-10"},N=P(()=>i("div",{class:"col-12 text-h6 text-weight-bold"},"Gr\xE1fico Predictivo de Ventas por Producto",-1)),U={class:"col-12 col-md-3"},I={class:"col-12 col-md-3"},O={class:"col-12 col-md-4"},Y={class:"col-12 col-md-auto"},E={class:"row justify-center"},j={class:"col-12 col-md-10"};function z(t,o,s,r,e,u){const h=v("apexchart");return b(),V(k,{class:"bg-grey-3 q-pa-md"},{default:n(()=>[a(f,{flat:"",bordered:"",class:"q-mb-lg"},{default:n(()=>[a(l,{class:"row items-center q-col-gutter-md"},{default:n(()=>[q,i("div",Q,[a(d,{modelValue:e.fecha_inicio,"onUpdate:modelValue":o[0]||(o[0]=c=>e.fecha_inicio=c),type:"date",label:"Fecha inicio",dense:"",outlined:""},null,8,["modelValue"])]),i("div",B,[a(d,{modelValue:e.fecha_fin,"onUpdate:modelValue":o[1]||(o[1]=c=>e.fecha_fin=c),type:"date",label:"Fecha fin",dense:"",outlined:""},null,8,["modelValue"])]),i("div",F,[a(p,{color:"primary","no-caps":"",icon:"search",label:"Buscar",loading:e.loadingGeneral,onClick:u.fetchChartData},null,8,["loading","onClick"])])]),_:1}),a(m),a(l,null,{default:n(()=>[i("div",G,[i("div",M,[a(h,{type:"line",options:e.chartOptions,series:e.chartSeries},null,8,["options","series"])])])]),_:1})]),_:1}),a(f,{flat:"",bordered:""},{default:n(()=>[a(l,{class:"row items-center q-col-gutter-md"},{default:n(()=>[N,i("div",U,[a(d,{modelValue:e.fecha_inicio,"onUpdate:modelValue":o[2]||(o[2]=c=>e.fecha_inicio=c),type:"date",label:"Fecha inicio",dense:"",outlined:""},null,8,["modelValue"])]),i("div",I,[a(d,{modelValue:e.fecha_fin,"onUpdate:modelValue":o[3]||(o[3]=c=>e.fecha_fin=c),type:"date",label:"Fecha fin",dense:"",outlined:""},null,8,["modelValue"])]),i("div",O,[a(S,{modelValue:e.selectedProduct,"onUpdate:modelValue":o[4]||(o[4]=c=>e.selectedProduct=c),options:e.products,label:"Producto",dense:"",outlined:"","emit-value":"","map-options":"","option-value":"value","option-label":"label"},null,8,["modelValue","options"])]),i("div",Y,[a(p,{color:"primary","no-caps":"",icon:"search",label:"Buscar",loading:e.loadingProduct,onClick:u.fetchChartDataProduct},null,8,["loading","onClick"])])]),_:1}),a(m),a(l,null,{default:n(()=>[i("div",E,[i("div",j,[a(h,{type:"line",options:e.chartOptionsProduct,series:e.chartSeriesProduct},null,8,["options","series"])])])]),_:1})]),_:1})]),_:1})}var W=y(T,[["render",z],["__scopeId","data-v-b216f932"]]);export{W as default};
