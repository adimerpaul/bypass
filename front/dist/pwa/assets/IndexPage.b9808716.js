import{_ as w,P as I,Q as n,R as d,S as r,T as o,aB as b,V as l,aC as p,U as c,a0 as x,a1 as S,a2 as N,aD as C,aE as T,aF as U,L as y,at as E,X as k,a3 as A,Z as m,W as u}from"./index.7527abf8.js";import{a as V,b as g}from"./QList.62fd012d.js";import{Q as B}from"./QBtnDropdown.b4476813.js";import{Q as _}from"./QChip.633c74ff.js";import{Q as F}from"./QMarkupTable.2cd8a231.js";import{Q as G}from"./QSpace.e2aab69f.js";import{Q as R}from"./QSelect.620cf417.js";import{Q as P}from"./QForm.0db4363a.js";import{Q as L}from"./QPage.d8a1b1a9.js";import{h as Q}from"./moment.40bc58bf.js";import{C as q}from"./Card2Component.512aebd4.js";import{P as Y}from"./index.aa4d44c1.js";import"./format.39a980fd.js";const z={name:"IndexPage",components:{Card2Component:q},data(){return{loading:!1,fechaInicio:Q().format("YYYY-MM-DD"),fechaFin:Q().format("YYYY-MM-DD"),sales:[],egresoDialog:!1,egreso:{},provedores:[]}},mounted(){this.salesGet(),this.provedoresGet()},methods:{egresoPost(){this.loading=!0,this.$axios.post("/egresos",this.egreso).then(s=>{this.$alert.success("Egreso registrado"),this.salesGet(),this.egresoDialog=!1}).catch(s=>{console.error(s),this.$alert.error("Error al registrar el egreso")}).finally(()=>{this.loading=!1})},provedoresGet(){this.$axios.get("/provedores").then(s=>{this.provedores=s.data}).catch(s=>{console.error(s)})},egreseClick(){this.egresoDialog=!0,this.egreso={total:"",provedor_id:"",descripcion:""}},reimprimir(s){let t="";if(s.type=="INGRESO"){console.log("reimprimir",s);let h="",i=0;s.details.forEach(a=>{h+="<tr><td>"+a.quantity+"</td><td>"+a.product+"</td><td>"+a.price+"</td><td>"+a.subtotal+"</td></tr>",i+=parseFloat(a.subtotal)}),t=`<style>
      .imagen{
        width:60%
      }
      .titulo1 {
      text-align:center;
      font-weight:bold;
      font-size:12px;
      }
      .titulo2 {
      text-align:center;
      font-size:10px;
      }
      .tab1{
      width:100%;
      text-align:center;
      font-size:10px;
      }
      .tab2{
      width:100%;
      font-size:10px;
      border-collapse: collapse;
      }
      .tab2  th{
      border: .1px solid;
      }
      .pie{
      text-align:center;
      font-size:8px;}
      </style>
      <div style='text-align:center'><img class='imagen' src="logo2.png"></div>
      <div class='titulo1'>CONTACTOS: 76130006</div>
      <div class='titulo2'>AV. TACNA ENTRE JAEN Y TOMAS FRIAS</div>
      <table class='tab1'><tr><td>`+s.date+"</td><td>"+s.time+`</td></tr></table><br>
      <table class='tab2'><tr><th>CANT</th><th>DETALLE</th><th>P/U</th><th>TOTAL</th></tr>
      `+h+`      
        <tr><td></td><td></td><td><b>TOTAL:</b></td><td>`+i.toFixed(1)+`</td></tr></table><br>
      <div class='pie'>GRACIAS POR SU COMPRA, BUEN PROVECHO</div>`}document.getElementById("myelement").innerHTML=t,new Y().print(document.getElementById("myelement"))},anular(s){this.$alert.confirm("\xBFEst\xE1 seguro de anular la venta?").onOk(()=>{this.$axios.post("saleAnular",{id:s.id}).then(t=>{this.$alert.success("Venta anulada"),this.salesGet()}).catch(t=>{console.error(t),this.$alert.error("Error al anular la venta")})})},salesGet(){this.loading=!0,this.$axios.get("/sales",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(s=>{this.sales=s.data}).catch(s=>{console.error(s)}).finally(()=>{this.loading=!1})}},computed:{ingresos(){let s=0;return this.sales.forEach(t=>{t.type==="INGRESO"&&t.status!=="ANULADO"&&(s+=t.total)}),s},egresos(){let s=0;return this.sales.forEach(t=>{t.type==="EGRESO"&&t.status!=="ANULADO"&&(s+=t.total)}),s},utilidad(){return this.ingresos-this.egresos}}},M={class:"row"},H={class:"col-12 col-md-2"},J={class:"col-12 col-md-2"},W={class:"col-12 col-md-2 text-center"},X={class:"col-12 col-md-6 text-right"},Z={class:"col-12 col-md-4 q-pa-xs"},j={class:"col-12 col-md-4 q-pa-xs"},K={class:"col-12 col-md-4 q-pa-xs"},$={class:"col-12"},ee=l("thead",{class:"bg-black text-white"},[l("tr",null,[l("th",null,"Opciones"),l("th",null,"Fecha"),l("th",null,"Tipo"),l("th",null,"Descripcion"),l("th",null,"Name"),l("th",null,"Total"),l("th",null,"Usuario")])],-1),te={class:"text-caption",style:{"max-width":"400px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},oe={class:"text-bold"},le=l("div",{class:"text-h6"},"Egreso",-1),se=l("div",{id:"myelement"},null,-1);function ie(s,t,D,h,i,a){const f=I("card2-component");return n(),d(L,{class:"q-pa-md bg-grey-3"},{default:r(()=>[o(C,null,{default:r(()=>[o(b,{class:"q-pa-xs"},{default:r(()=>[l("div",M,[l("div",H,[o(p,{modelValue:i.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=e=>i.fechaInicio=e),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),l("div",J,[o(p,{modelValue:i.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=e=>i.fechaFin=e),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),l("div",W,[o(c,{label:"Buscar",color:"indigo",onClick:a.salesGet,loading:i.loading,"no-caps":"",icon:"search",class:"text-bold"},null,8,["onClick","loading"])]),l("div",X,[o(c,{label:"Egreso",color:"red",onClick:a.egreseClick,loading:i.loading,"no-caps":"",icon:"add_circle_outline",class:"text-bold"},null,8,["onClick","loading"])]),l("div",Z,[o(f,{title:"Ingresos",subtitle:a.ingresos+" Bs.",icon:"trending_up",color:"green"},null,8,["subtitle"])]),l("div",j,[o(f,{title:"Egresos",subtitle:a.egresos+" Bs.",icon:"trending_down",color:"red"},null,8,["subtitle"])]),l("div",K,[o(f,{title:"Utilidad",subtitle:a.utilidad+" Bs.",icon:"trending_flat",color:"blue"},null,8,["subtitle"])]),l("div",$,[o(F,{dense:"","wrap-cells":""},{default:r(()=>[ee,l("tbody",null,[(n(!0),x(N,null,S(i.sales,e=>{var v;return n(),x("tr",{key:e.id},[l("td",null,[e.status!=="ANULADO"?(n(),d(B,{key:0,label:"Opciones","no-caps":"",size:"10px",dense:"",color:e.type==="EGRESO"?"red":"green","auto-close":""},{default:r(()=>[y((n(),d(V,{clickable:"",onClick:O=>a.reimprimir(e)},{default:r(()=>[o(g,{avatar:""},{default:r(()=>[o(E,{name:"print"})]),_:1}),o(g,null,{default:r(()=>[k("Reimprimir")]),_:1})]),_:2},1032,["onClick"])),[[A]]),y((n(),d(V,{clickable:"",onClick:O=>a.anular(e)},{default:r(()=>[o(g,{avatar:""},{default:r(()=>[o(E,{name:"cancel"})]),_:1}),o(g,null,{default:r(()=>[k("Anular")]),_:1})]),_:2},1032,["onClick"])),[[A]])]),_:2},1032,["color"])):m("",!0),e.status==="ANULADO"?(n(),d(_,{key:1,color:"red","text-color":"white",label:"Anulado",size:"12px",dense:""})):m("",!0)]),l("td",null,u(s.$filters.formatdMYHi(e.date+" "+e.time)),1),l("td",null,[e.type==="INGRESO"?(n(),d(_,{key:0,color:"green","text-color":"white",label:"Ingreso",size:"12px",dense:""})):m("",!0),e.type==="EGRESO"?(n(),d(_,{key:1,color:"red","text-color":"white",label:"Egreso",size:"12px",dense:""})):m("",!0)]),l("td",null,[l("div",te,u(e.descripcion),1)]),l("td",null,u(e.name),1),l("td",oe,u(e.total)+" Bs",1),l("td",null,u((v=e.user)==null?void 0:v.name),1)])}),128))])]),_:1})])])]),_:1})]),_:1}),o(U,{modelValue:i.egresoDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>i.egresoDialog=e),persistent:""},{default:r(()=>[o(C,null,{default:r(()=>[o(b,{class:"row items-center q-pb-none"},{default:r(()=>[le,o(G),o(c,{flat:"",round:"",dense:"",icon:"close",onClick:t[2]||(t[2]=e=>i.egresoDialog=!1)})]),_:1}),o(b,null,{default:r(()=>[o(P,{onSubmit:a.egresoPost},{default:r(()=>[o(p,{modelValue:i.egreso.total,"onUpdate:modelValue":t[3]||(t[3]=e=>i.egreso.total=e),label:"Total",type:"number",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"],step:"0.01"},null,8,["modelValue","rules"]),o(R,{modelValue:i.egreso.provedor_id,"onUpdate:modelValue":t[4]||(t[4]=e=>i.egreso.provedor_id=e),label:"Provedor",outlined:"",dense:"",options:i.provedores,"option-value":"id","option-label":"name",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","options","rules"]),o(p,{modelValue:i.egreso.descripcion,"onUpdate:modelValue":t[5]||(t[5]=e=>i.egreso.descripcion=e),label:"Descripcion",type:"text",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),o(T,{align:"right"},{default:r(()=>[o(c,{label:"Cancelar",color:"red",onClick:t[6]||(t[6]=e=>i.egresoDialog=!1),"no-caps":"",icon:"close",loading:i.loading},null,8,["loading"]),o(c,{label:"Guardar",color:"green",type:"submit","no-caps":"",icon:"save",loading:i.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),se]),_:1})}var ve=w(z,[["render",ie]]);export{ve as default};
