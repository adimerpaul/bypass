import{_ as A,P as y,Q as c,R as h,S as d,T as i,aB as u,V as s,aC as g,U as n,aD as b,W as f,Y as I,ar as E,b8 as P,a4 as q,a0 as p,X as k,a2 as S,a1 as U,Z as _,aF as V}from"./index.453c62e5.js";import{Q as C}from"./QSpace.43aef6ce.js";import{Q as T}from"./QImg.8eed39c6.js";import{Q as F}from"./QBadge.5660ba61.js";import{Q as D}from"./QSelect.6082f557.js";import{f as N}from"./format.6549254d.js";import{Q as G}from"./QMarkupTable.c218b293.js";import{Q as w}from"./QForm.210502cd.js";import{Q as B}from"./QPage.62823b2d.js";import{P as z}from"./ProductCard.e6a4ef1d.js";import{C as L,E as O}from"./Excel.034fca60.js";import"./QList.58d4b4b2.js";import"./_commonjsHelpers.a26ce4be.js";const M={name:"ProductsIndex",components:{ProductCard:z,Card2Component:L},data(){return{products:[],productsAll:[],product:{},categories:[],category:"",search:"",productDialog:!1,loading:!1,insumos:[],insumosAll:[],insumosDialog:!1,insumo:{}}},mounted(){this.productsGet(),this.categoriesGet(),this.insumosGet()},methods:{filerInsumos(t){t===""?this.insumos=this.insumosAll:this.insumos=this.insumosAll.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()))},insumoDelete(t){this.$alert.confirm("\xBFEstas seguro de eliminar este insumo?").onOk(()=>{var e;this.loading=!0,this.$axios.delete(`insumosProduct/${(e=t.pivot)==null?void 0:e.id}`).then(r=>{this.product={...r.data};const m=this.products.findIndex(o=>o.id===r.data.id);this.products.splice(m,1,r.data)}).finally(()=>{this.loading=!1})})},insumoSave(){this.loading=!0,this.$axios.post("insumosProduct",this.insumo).then(t=>{this.insumosDialog=!1,this.product={...t.data};const e=this.products.findIndex(r=>r.id===t.data.id);this.products.splice(e,1,t.data)}).finally(()=>{this.loading=!1}).catch(t=>{this.$alert.error(t.response.data.message)})},insumosClick(){this.insumosDialog=!0,this.insumo={product_id:this.product.id,insumo_id:"",quantity:""}},insumosGet(){this.$axios.get("listInsumo").then(t=>{this.insumos=t.data,this.insumosAll=t.data})},downloadExcel(){let t=[{columns:[{label:"Nombre",value:"name"},{label:"Precio",value:"price"},{label:"Costo",value:"costo"},{label:"Stock",value:"stock"},{label:"Categoria",value:"category.name"},{label:"Estado",value:"status"}],content:this.products}];O.export(t,"Productos")},productFilter(t){t?this.products=this.productsAll.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())):this.products=this.productsAll},productDelete(){this.$alert.confirm("\xBFEstas seguro de eliminar este producto?").onOk(()=>{this.loading=!0,this.$axios.delete(`products/${this.product.id}`).then(t=>{this.productDialog=!1;const e=this.products.findIndex(r=>r.id===t.data.id);this.products.splice(e,1)}).finally(()=>{this.loading=!1}).catch(t=>{this.$alert.error(t.response.data.message)})})},handleFileChange(){const t=event.target.files[0];t&&(this.product.image=URL.createObjectURL(t))},productCreate(){if(this.$refs.file.files.length===0)return this.$alert.error("Debe seleccionar una imagen"),!1;this.loading=!0;const t=new FormData;t.append("product",JSON.stringify(this.product)),t.append("file",this.$refs.file.files[0]),this.$axios.post("products",t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.productDialog=!1,this.products.push(e.data)}).finally(()=>{this.loading=!1})},productUpdate(){this.loading=!0;const t=new FormData;t.append("product",JSON.stringify(this.product)),this.$refs.file.files.length>0&&t.append("file",this.$refs.file.files[0]),this.$axios.post(`products/${this.product.id}`,t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.productDialog=!1;const r=this.products.findIndex(m=>m.id===e.data.id);this.products.splice(r,1,e.data)}).finally(()=>{this.loading=!1})},productSave(){this.product.id?this.productUpdate():this.productCreate()},productClick(){this.productDialog=!0,this.product={name:"",description:"",price:"",stock:"",image:"images.png",status:"ACTIVE",costo:""}},categoryClick(t){this.category=t.id,t.id?this.products=this.productsAll.filter(e=>e.category_id===t.id):this.products=this.productsAll},productEditClick(t){this.productDialog=!0,this.product={...t}},productsGet(){this.$axios.get("products").then(t=>{this.products=t.data,this.productsAll=t.data})},categoriesGet(){this.$axios.get("categories").then(t=>{this.categories=t.data})}},computed:{categoryMoreAll(){return[{id:"",name:"Todo",icon:"fa-solid fa-globe"},...this.categories]},totalPrice(){let t=0;return this.products.forEach(e=>{t+=e.price*e.stock}),t.toFixed(2)},totalCost(){let t=0;return this.products.forEach(e=>{t+=e.costo*e.stock}),t.toFixed(2)}}},R={class:"row"},J={class:"col-12 col-md-4"},j={class:"col-12 col-md-2"},W={class:"col-12 col-md-6 text-right"},X={class:"col-12 col-md-4 q-pa-xs"},Y={class:"col-12 col-md-4 q-pa-xs"},Z={class:"col-12 col-md-4 q-pa-xs"},H={class:"col-12"},K={class:"text-bold text-h6"},$={class:"row"},tt={class:"col-12 col-md-12 flex flex-center"},et={class:"col-12"},ot=s("label",{class:"text-caption text-bold"},"Nombre:",-1),lt={class:"col-12 col-md-4"},st=s("label",{class:"text-caption text-bold"},"Precio:",-1),it={class:"col-12 col-md-8"},dt=s("label",{class:"text-caption text-bold"},"Categoria:",-1),at={class:"col-12 col-md-6"},rt=s("label",{class:"text-caption text-bold"},"Estado:",-1),nt={key:0,class:"col-12"},ct={class:"text-caption text-bold row items-center"},ut=s("thead",{class:"bg-black text-white"},[s("tr",null,[s("th",null,"Nombre"),s("th",null,"Cantidad"),s("th",null,"Opciones")])],-1),pt={key:0},mt={class:"text-right",style:{"line-height":"0.8"}},ht=s("br",null,null,-1),gt={class:"text-right"},ft={key:1},_t=s("tr",null,[s("td",{colspan:"3",class:"text-center"},"No hay insumos")],-1),xt=[_t],bt=s("div",{class:"text-bold text-h6"}," Agregar Insumos ",-1),Ct={class:"row"},vt={class:"col-12"},yt=s("label",{class:"text-caption text-bold"},"Insumo:",-1),kt={class:"col-12"},Vt=s("label",{class:"text-caption text-bold"},"Cantidad:",-1);function Dt(t,e,r,m,o,a){const x=y("Card2Component"),Q=y("ProductCard");return c(),h(B,{class:"bg-grey-3 q-pa-xs"},{default:d(()=>[i(b,null,{default:d(()=>[i(u,{class:"q-pa-xs"},{default:d(()=>[s("div",R,[s("div",J,[i(g,{modelValue:o.search,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.search=l),a.productFilter],label:"Buscar",outlined:"",dense:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),s("div",j,[i(n,{color:"grey-8",label:"Descargar",class:"text-bold","no-caps":"",icon:"get_app",flat:"",rounded:"",onClick:a.downloadExcel},null,8,["onClick"])]),s("div",W,[i(n,{color:"green",label:"Crear Producto",class:"text-bold",onClick:e[1]||(e[1]=l=>a.productClick()),"no-caps":"",icon:"add_circle",rounded:"",loading:o.loading},null,8,["loading"])]),s("div",X,[i(x,{color:"green-8",title:"Productos",subtitle:o.products.length+" Unid",icon:"all_inbox"},null,8,["subtitle"])]),s("div",Y,[i(x,{color:"indigo-8",title:"Total Stock",subtitle:"0.00 $",icon:"shopping_cart"})]),s("div",Z,[i(x,{color:"purple-8",title:"Total Ganancias",subtitle:a.totalCost+" $",icon:"attach_money"},null,8,["subtitle"])]),s("div",H,[i(Q,{products:o.products,onProductClick:a.productEditClick,categories:a.categoryMoreAll,onCategoryClick:a.categoryClick},null,8,["products","onProductClick","categories","onCategoryClick"])])])]),_:1})]),_:1}),i(V,{modelValue:o.productDialog,"onUpdate:modelValue":e[9]||(e[9]=l=>o.productDialog=l),maximized:"",position:"right"},{default:d(()=>[i(b,{style:{width:"350px","max-width":"80vw"}},{default:d(()=>[i(u,{class:"row items-center q-pb-none"},{default:d(()=>[s("div",K,f(o.product.id?"Editar":"Crear")+" Producto ",1),i(C),i(n,{flat:"",icon:"close",onClick:e[2]||(e[2]=l=>o.productDialog=!1)})]),_:1}),i(u,null,{default:d(()=>[i(w,{onSubmit:a.productSave},{default:d(()=>[s("div",$,[s("div",tt,[i(I,{onClick:e[3]||(e[3]=l=>t.$refs.file.click()),class:"bg-grey-3","text-color":"grey-8",rounded:"",size:"140px"},{default:d(()=>[i(T,{src:o.product.image.includes("http")?o.product.image:`${t.$url}../images/${o.product.image}`,"spinner-color":"grey-8","spinner-size":"40",style:{height:"140px"}},null,8,["src"]),i(F,{color:"grey-8","text-color":"white",floating:""},{default:d(()=>[i(E,{name:"camera_alt"})]),_:1})]),_:1}),s("input",{type:"file",class:"hidden",onChange:e[4]||(e[4]=(...l)=>a.handleFileChange&&a.handleFileChange(...l)),ref:"file",accept:"image/*"},null,544)]),s("div",et,[ot,i(g,{modelValue:o.product.name,"onUpdate:modelValue":e[5]||(e[5]=l=>o.product.name=l),outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",lt,[st,i(g,{modelValue:o.product.price,"onUpdate:modelValue":e[6]||(e[6]=l=>o.product.price=l),outlined:"",dense:"",type:"number",step:"0.01",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",it,[dt,i(D,{modelValue:o.product.category_id,"onUpdate:modelValue":e[7]||(e[7]=l=>o.product.category_id=l),options:o.categories,outlined:"",dense:"","emit-value":"","map-options":"","option-value":"id","option-label":"name",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","rules"])]),s("div",at,[rt,i(P,{modelValue:o.product.status,"onUpdate:modelValue":e[8]||(e[8]=l=>o.product.status=l),color:o.product.status?"green":"red","true-value":"ACTIVE","false-value":"INACTIVE"},{default:d(()=>[s("div",{class:q(`text-${o.product.status==="ACTIVE"?"green":"red"} text-subtitle2 text-bold`)},f(o.product.status==="ACTIVE"?"Activo":"Inactivo"),3)]),_:1},8,["modelValue","color"])]),o.product.id!==void 0?(c(),p("div",nt,[s("label",ct,[k(" Insumos: "),i(C),i(n,{color:"green",label:"Agregar",class:"text-bold","no-caps":"",icon:"add_circle",rounded:"",size:"10px",onClick:a.insumosClick},null,8,["onClick"])]),i(G,{dense:"",flat:"",bordered:""},{default:d(()=>[ut,o.product.insumos.length>0?(c(),p("tbody",pt,[(c(!0),p(S,null,U(o.product.insumos,l=>{var v;return c(),p("tr",{key:l.id},[s("td",null,f(l==null?void 0:l.name),1),s("td",mt,[i(N,{label:l.unit,color:l.unit==="UNIDAD"?"green":"orange","text-color":"white",dense:"",size:"10px"},null,8,["label","color"]),ht,k(" "+f((v=l==null?void 0:l.pivot)==null?void 0:v.quantity),1)]),s("td",gt,[i(n,{color:"red",flat:"",icon:"delete",onClick:wt=>a.insumoDelete(l)},null,8,["onClick"])])])}),128))])):(c(),p("tbody",ft,xt))]),_:1})])):_("",!0)]),s("div",null,[o.product.id===void 0?(c(),h(n,{key:0,color:"green",label:"Guardar",class:"text-bold full-width",type:"submit","no-caps":"",icon:"save",rounded:"",loading:o.loading},null,8,["loading"])):_("",!0),o.product.id!==void 0?(c(),h(n,{key:1,color:"yellow-8",label:"Actualizar",class:"text-bold full-width q-mb-md",type:"submit","no-caps":"",icon:"save",rounded:"",loading:o.loading},null,8,["loading"])):_("",!0),o.product.id!==void 0?(c(),h(n,{key:2,color:"red",outline:"",label:"Eliminar",class:"text-bold full-width","no-caps":"",icon:"close",rounded:"",onClick:a.productDelete,loading:o.loading},null,8,["onClick","loading"])):_("",!0)])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(V,{modelValue:o.insumosDialog,"onUpdate:modelValue":e[13]||(e[13]=l=>o.insumosDialog=l)},{default:d(()=>[i(b,{style:{width:"350px","max-width":"80vw"}},{default:d(()=>[i(u,{class:"row items-center q-pb-none"},{default:d(()=>[bt,i(C),i(n,{flat:"",icon:"close",onClick:e[10]||(e[10]=l=>o.insumosDialog=!1)})]),_:1}),i(u,null,{default:d(()=>[i(w,{onSubmit:a.insumoSave},{default:d(()=>[s("div",Ct,[s("div",vt,[yt,i(D,{modelValue:o.insumo.insumo_id,"onUpdate:modelValue":e[11]||(e[11]=l=>o.insumo.insumo_id=l),options:o.insumos,outlined:"",dense:"","emit-value":"","map-options":"","option-value":"id","option-label":"name",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","rules"])]),s("div",kt,[Vt,i(g,{modelValue:o.insumo.quantity,"onUpdate:modelValue":e[12]||(e[12]=l=>o.insumo.quantity=l),outlined:"",dense:"",type:"number",step:"0.01",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])])]),s("div",null,[i(n,{color:"green",label:"Guardar",class:"text-bold full-width",type:"submit","no-caps":"",icon:"save",rounded:"",loading:o.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var zt=A(M,[["render",Dt]]);export{zt as default};
